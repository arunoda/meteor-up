{"version":3,"sources":["../src/nodemiral.js"],"names":["copy","session","_options","callback","options","retries","hostVars","_host","vars","doCopy","src","dest","cb","err","console","log","setTimeout","registerTask"],"mappings":";;8QAAA;;;AACA;;;;AACA;;;;AAEA,SAASA,IAAT,CAAcC,OAAd,EAAuBC,QAAvB,EAAiCC,QAAjC,EAA2C;AACzC,MAAMC,UAAU,mBAAMF,QAAN,CAAhB;AACA,MAAIG,UAAU,CAAd;;AAEA,MAAI,QAAOD,QAAQE,QAAf,MAA4B,QAA5B,IAAwCF,QAAQE,QAAR,CAAiBL,QAAQM,KAAzB,CAA5C,EAA6E;AAC3EH,YAAQI,IAAR,GAAe,mBAAMJ,QAAQI,IAAd,EAAoBJ,QAAQE,QAAR,CAAiBL,QAAQM,KAAzB,CAApB,CAAf;AACD;;AAED,WAASE,MAAT,GAAkB;AAChBR,YAAQD,IAAR,CAAaI,QAAQM,GAArB,EAA0BN,QAAQO,IAAlC,EAAwCP,OAAxC,EAAiDQ,EAAjD;AACD;AACD,WAASA,EAAT,CAAYC,GAAZ,EAAiB;AACf,QAAIA,OAAOR,UAAU,CAArB,EAAwB;AACtBS,cAAQC,GAAR,CAAY,sBAAZ,EAAoCF,GAApC;AACAC,cAAQC,GAAR,CAAY,uBAAZ;;AAEAC,iBAAWP,MAAX,EAAmB,IAAnB;AACA;AACD;AACDN,aAASU,GAAT;AACD;;AAEDJ;AACD;;AAED,oBAAUQ,YAAV,CAAuB,MAAvB,EAA+BjB,IAA/B","file":"nodemiral.js","sourcesContent":["// Registers additional nodemiral tasks\r\nimport nodemiral from 'nodemiral';\r\nimport { clone, merge } from 'lodash';\r\n\r\nfunction copy(session, _options, callback) {\r\n  const options = clone(_options);\r\n  let retries = 0;\r\n\r\n  if (typeof options.hostVars === 'object' && options.hostVars[session._host]) {\r\n    options.vars = merge(options.vars, options.hostVars[session._host]);\r\n  }\r\n\r\n  function doCopy() {\r\n    session.copy(options.src, options.dest, options, cb);\r\n  }\r\n  function cb(err) {\r\n    if (err && retries < 3) {\r\n      console.log('Failed to copy file ', err);\r\n      console.log('Retrying in 3 seconds');\r\n\r\n      setTimeout(doCopy, 3000);\r\n      return;\r\n    }\r\n    callback(err);\r\n  }\r\n\r\n  doCopy();\r\n}\r\n\r\nnodemiral.registerTask('copy', copy);\r\n"]}