{"version":3,"sources":["../../../src/plugins/mongo/index.js"],"names":["prepareConfig","_commands","description","commands","validate","mongo","config","app","env","name","split","join","docker","args","push","hooks","api","getConfig","runCommand","then"],"mappings":";;;;;;QAUgBA,a,GAAAA,a;;AAVhB;;IAAYC,S;;AAEZ;;;;;;;;AAEO,IAAMC,oCAAc,4BAApB;AACA,IAAIC,8BAAWF,SAAf;AACA,IAAMG,8BAAW;AACtBC;AADsB,CAAjB;;AAIA,SAASL,aAAT,CAAuBM,MAAvB,EAA+B;AACpC,MAAI,CAACA,OAAOC,GAAR,IAAe,CAACD,OAAOD,KAA3B,EAAkC;AAChC,WAAOC,MAAP;AACD;;AAEDA,SAAOC,GAAP,CAAWC,GAAX,GAAiBF,OAAOC,GAAP,CAAWC,GAAX,IAAkB,EAAnC;AACAF,SAAOC,GAAP,CAAWC,GAAX,CAAe,WAAf,iCAAyDF,OAAOC,GAAP,CAAWE,IAAX,CAAgBC,KAAhB,CAAsB,GAAtB,EAA2BC,IAA3B,CAAgC,EAAhC,CAAzD;;AAEA,MAAI,CAACL,OAAOC,GAAP,CAAWK,MAAhB,EAAwB;AACtBN,WAAOC,GAAP,CAAWK,MAAX,GAAoB,EAApB;AACD;;AAED,MAAI,CAACN,OAAOC,GAAP,CAAWK,MAAX,CAAkBC,IAAvB,EAA6B;AAC3BP,WAAOC,GAAP,CAAWK,MAAX,CAAkBC,IAAlB,GAAyB,EAAzB;AACD;;AAEDP,SAAOC,GAAP,CAAWK,MAAX,CAAkBC,IAAlB,CAAuBC,IAAvB,CAA4B,wBAA5B;AACA,SAAOR,MAAP;AACD;;AAEM,IAAMS,wBAAQ;AACnB,sBADmB,4BACEC,GADF,EACO;AACxB,QAAMV,SAASU,IAAIC,SAAJ,EAAf;AACA,QAAIX,OAAOD,KAAX,EAAkB;AAChB,aAAOW,IAAIE,UAAJ,CAAe,aAAf,EAA8BC,IAA9B,CAAmC;AAAA,eAAMH,IAAIE,UAAJ,CAAe,aAAf,CAAN;AAAA,OAAnC,CAAP;AACD;AACF;AANkB,CAAd","file":"index.js","sourcesContent":["import * as _commands from './commands';\r\n\r\nimport _validator from './validate';\r\n\r\nexport const description = 'Commands to manage MongoDB';\r\nexport let commands = _commands;\r\nexport const validate = {\r\n  mongo: _validator\r\n};\r\n\r\nexport function prepareConfig(config) {\r\n  if (!config.app || !config.mongo) {\r\n    return config;\r\n  }\r\n\r\n  config.app.env = config.app.env || {};\r\n  config.app.env['MONGO_URL'] = `mongodb://mongodb:27017/${config.app.name.split('.').join('')}`;\r\n\r\n  if (!config.app.docker) {\r\n    config.app.docker = {};\r\n  }\r\n\r\n  if (!config.app.docker.args) {\r\n    config.app.docker.args = [];\r\n  }\r\n\r\n  config.app.docker.args.push('--link=mongodb:mongodb');\r\n  return config;\r\n}\r\n\r\nexport const hooks = {\r\n  'post.default.setup'(api) {\r\n    const config = api.getConfig();\r\n    if (config.mongo) {\r\n      return api.runCommand('mongo.setup').then(() => api.runCommand('mongo.start'));\r\n    }\r\n  }\r\n};\r\n"]}