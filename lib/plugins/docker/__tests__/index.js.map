{"version":3,"sources":["../../../../src/plugins/docker/__tests__/index.js"],"names":["config","silent","servers","require","timeout","checkDocker","name","serverInfo","cd","tmpdir","out","exec","equal","code","num","output","sshOut"],"mappings":";;AAAA;;AAEA;;AAEA;;;;AACA;;;;AACA;;;;;;;AALA;;;AAOA,kBAAGA,MAAH,CAAUC,MAAV,GAAmB,KAAnB;AACA,IAAMC,UAAUC,QAAQ,oCAAR,CAAhB;;AAEA,qBAAS,iBAAT,EAA4B,YAAW;AACrC,OAAKC,OAAL,CAAa,OAAb;;AAEA,uBAAS,OAAT,EAAkB,YAAW;AAC3B;AACA;AACA;AACA,aAASC,WAAT,CAAqBC,IAArB,EAA2B;AACzB;AACA,UAAMC,aAAaL,QAAQ,OAAOI,IAAf,CAAnB;;AAEA,qEAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AACL,qBAAKF,OAAL,CAAa,KAAb;;AAEA,kCAAGI,EAAH,CAAM,wBAAY,aAAGC,MAAH,EAAZ,EAAyB,iBAAzB,CAAN;AACMC,mBAJD,GAIO,kBAAGC,IAAH,CAAQ,kBAAR,CAJP;;AAKL,iCAAOC,KAAP,CAAaF,IAAIG,IAAjB,EAAuB,CAAvB;;AAEMC,mBAPD,GAOO,4BAAgB,uBAAhB,EAAyCJ,IAAIK,MAA7C,CAPP;;AAQL,iCAAOH,KAAP,CAAaE,GAAb,EAAkB,CAAlB;;AARK;AAAA,uBAUgB,0BAAcP,UAAd,EAA0B,cAA1B,CAVhB;;AAAA;AAUCS,sBAVD;;AAWL,iCAAOJ,KAAP,CAAaI,OAAOH,IAApB,EAA0B,CAA1B;;AAXK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAP;AAaD;;AAED,mBAAG,sCAAH,EAA2CR,YAAY,QAAZ,CAA3C;AACA,mBAAG,qCAAH,EAA0CA,YAAY,OAAZ,CAA1C;AACA,mBAAG,qCAAH,EAA0CA,YAAY,OAAZ,CAA1C;AACD,GA1BD;AA2BD,CA9BD","file":"index.js","sourcesContent":["import { countOccurences, resolvePath, runSSHCommand } from '../../../utils';\r\n/* eslint-disable max-len */\r\nimport { describe, it } from 'mocha';\r\n\r\nimport assert from 'assert';\r\nimport os from 'os';\r\nimport sh from 'shelljs';\r\n\r\nsh.config.silent = false;\r\nconst servers = require('../../../../tests/fixtures/servers');\r\n\r\ndescribe('module - docker', function() {\r\n  this.timeout(6000000);\r\n\r\n  describe('setup', function() {\r\n    // reuse this function for 3 tests below\r\n    // TODO break this into multiple functions\r\n    // so parts can be used for other tests\r\n    function checkDocker(name) {\r\n      // TODO get server name form mup.js file\r\n      const serverInfo = servers['my' + name];\r\n\r\n      return async function() {\r\n        this.timeout(60000);\r\n\r\n        sh.cd(resolvePath(os.tmpdir(), 'tests/project-1'));\r\n        const out = sh.exec('mup docker setup');\r\n        assert.equal(out.code, 0);\r\n\r\n        const num = countOccurences('Setup Docker: SUCCESS', out.output);\r\n        assert.equal(num, 1);\r\n\r\n        const sshOut = await runSSHCommand(serverInfo, 'which docker');\r\n        assert.equal(sshOut.code, 0);\r\n      };\r\n    }\r\n\r\n    it('should install docker on \"meteor\" vm', checkDocker('meteor'));\r\n    it('should install docker on \"mongo\" vm', checkDocker('mongo'));\r\n    it('should install docker on \"proxy\" vm', checkDocker('proxy'));\r\n  });\r\n});\r\n"]}