{"version":3,"sources":["../../src/validate/index.js"],"names":["addPluginValidator","validate","utils","combineErrorDetails","VALIDATE_OPTIONS","improveErrors","_pluginValidators","rootPath","handler","generateSchema","topLevelKeys","servers","object","app","plugins","array","hooks","pattern","alternatives","localCommand","string","remoteCommand","method","func","Object","keys","forEach","key","any","validateAll","config","details","results","entries","property","validator","undefined","map","errors","error","message"],"mappings":";;;;;;;;;QASgBA,kB,GAAAA,kB;kBA+CQC,Q;;AAxDxB;;IAAYC,K;;AAEZ;;;;AACA;;;;;;;;IAEQC,mB,GAAyDD,K,CAAzDC,mB;IAAqBC,gB,GAAoCF,K,CAApCE,gB;IAAkBC,a,GAAkBH,K,CAAlBG,a;AAExC,IAAMC,gDAAoB,EAA1B;;AAEA,SAASN,kBAAT,CAA4BO,QAA5B,EAAsCC,OAAtC,EAA+C;AACpDF,oBAAkBC,QAAlB,IAA8BC,OAA9B;AACD;;AAED,SAASC,cAAT,GAA0B;AACxB,MAAMC,eAAe;AACnBC,aAAS,cAAIC,MAAJ,EADU;AAEnBC,SAAK,cAAID,MAAJ,EAFc;AAGnBE,aAAS,cAAIC,KAAJ,EAHU;AAInBC,WAAO,cAAIJ,MAAJ,GAAaK,OAAb,CAAqB,IAArB,EAA2B,cAAIC,YAAJ,CAAiB,cAAIN,MAAJ,CAAW;AAC5DO,oBAAc,cAAIC,MAAJ,EAD8C;AAE5DC,qBAAe,cAAID,MAAJ,EAF6C;AAG5DE,cAAQ,cAAIC,IAAJ;AAHoD,KAAX,CAAjB,EAKlC,cAAIA,IAAJ,EALkC,CAA3B;AAJY,GAArB;;AAaAC,SAAOC,IAAP,CAAYnB,iBAAZ,EAA+BoB,OAA/B,CAAuC,eAAO;AAC5ChB,iBAAaiB,GAAb,IAAoB,cAAIC,GAAJ,EAApB;AACD,GAFD;;AAIA,SAAO,cAAIhB,MAAJ,GAAaa,IAAb,CAAkBf,YAAlB,CAAP;AACD;;AAED,SAASmB,WAAT,CAAqBC,MAArB,EAA6B;AAC3B,MAAIC,UAAU,EAAd;AACA,MAAIC,gBAAJ;;AAEAA,YAAU,cAAI/B,QAAJ,CAAa6B,MAAb,EAAqBrB,gBAArB,EAAuCL,gBAAvC,CAAV;AACA2B,YAAU5B,oBAAoB4B,OAApB,EAA6BC,OAA7B,CAAV;;AAEA,MAAIF,OAAOnB,OAAX,EAAoB;AAClBqB,cAAU,uBAAeF,OAAOnB,OAAtB,CAAV;AACAoB,cAAU5B,oBAAoB4B,OAApB,EAA6BC,OAA7B,CAAV;AACD;;AAV0B;AAAA;AAAA;;AAAA;AAY3B,yBAAoCR,OAAOS,OAAP,CAAe3B,iBAAf,CAApC,8HAAuE;AAAA;AAAA,UAA3D4B,QAA2D;AAAA,UAAjDC,SAAiD;;AACrE,UAAIL,OAAOI,QAAP,MAAqBE,SAAzB,EAAoC;AAClCJ,kBAAUG,UAAUL,MAAV,EAAkB5B,KAAlB,CAAV;AACA6B,kBAAU5B,oBAAoB4B,OAApB,EAA6BC,OAA7B,CAAV;AACD;AACF;AAjB0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAmB3B,SAAOD,QAAQM,GAAR,CAAYhC,aAAZ,CAAP;AACD;;AAEc,SAASJ,QAAT,CAAkB6B,MAAlB,EAA0B;AACvC,MAAIQ,SAAST,YAAYC,MAAZ,CAAb;AACA,SAAOQ,OAAOD,GAAP,CAAW,iBAAS;AACzB,WAAOE,MAAMC,OAAb;AACD,GAFM,CAAP;AAGD","file":"index.js","sourcesContent":["import * as utils from './utils';\r\n\r\nimport joi from 'joi';\r\nimport validateServer from './servers';\r\n\r\nconst { combineErrorDetails, VALIDATE_OPTIONS, improveErrors } = utils;\r\n\r\nexport const _pluginValidators = {};\r\n\r\nexport function addPluginValidator(rootPath, handler) {\r\n  _pluginValidators[rootPath] = handler;\r\n}\r\n\r\nfunction generateSchema() {\r\n  const topLevelKeys = {\r\n    servers: joi.object(),\r\n    app: joi.object(),\r\n    plugins: joi.array(),\r\n    hooks: joi.object().pattern(/.*/, joi.alternatives(joi.object({\r\n      localCommand: joi.string(),\r\n      remoteCommand: joi.string(),\r\n      method: joi.func()\r\n    }),\r\n    joi.func()\r\n    ))\r\n  };\r\n\r\n  Object.keys(_pluginValidators).forEach(key => {\r\n    topLevelKeys[key] = joi.any();\r\n  });\r\n\r\n  return joi.object().keys(topLevelKeys);\r\n}\r\n\r\nfunction validateAll(config) {\r\n  let details = [];\r\n  let results;\r\n\r\n  results = joi.validate(config, generateSchema(), VALIDATE_OPTIONS);\r\n  details = combineErrorDetails(details, results);\r\n\r\n  if (config.servers) {\r\n    results = validateServer(config.servers);\r\n    details = combineErrorDetails(details, results);\r\n  }\r\n\r\n  for (const [property, validator] of Object.entries(_pluginValidators)) {\r\n    if (config[property] !== undefined) {\r\n      results = validator(config, utils);\r\n      details = combineErrorDetails(details, results);\r\n    }\r\n  }\r\n\r\n  return details.map(improveErrors);\r\n}\r\n\r\nexport default function validate(config) {\r\n  let errors = validateAll(config);\r\n  return errors.map(error => {\r\n    return error.message;\r\n  });\r\n}\r\n"]}